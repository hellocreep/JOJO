!function(a){"function"==typeof define&&define.amd?define(["raphael","underscore"],a):a(Raphael,underscore)}(function(a){function b(a,b){for(var c=a.centerX,d=a.centerY,e=a.count,f=a.deg,g=a.r,h=0;e>h;h++){var i,j,k;i=2*Math.PI/360*f*h,j=c+Math.sin(i)*g,k=d-Math.cos(i)*g,b(j,k,h)}}function c(a){var b,c=function(a,b){return b[a]?b[a].toString().replace(","," "):!1},d=c("from",a),e=c("to",a),f="M"+d,g="L"+e;return b=d?e?f+g:f:g}function d(a){for(var b="",c=65,d=_.keys(a).length;64+d>c;c++)b+=String.fromCharCode(c)+" ";return b.trim().split(" ").reverse().toString().replace(/,/g,"")}function e(a){this.conf=_.extend(e.DEFAULTS,a),this.init(this.conf),this.allCircle().innerLine().levelFigure().levelStatus(),this.circleSet.attr("stroke-width",1.5),this.decoratorFigure().levelArea()}return e.DEFAULTS={container:"stand",centerX:200,centerY:200,count:6,r:150,width:980,height:600,levelTotal:5,figureCount:20},e.prototype.init=function(b){return b.sr=b.r-10,b.fr=b.r/1.6,b.deg=360/b.count,b.levelWidth=b.fr/(b.levelTotal+1),b.levelCode=d(b.data.status),this.paper=a(b.container,b.width,b.height),this.paper},e.prototype.update=function(a){this.conf.data=a,this.decoratorFigure().levelStatus().levelArea()},e.prototype.allCircle=function(){var a,b=this.paper,c=this.conf;return a=b.set(),a.push(b.circle(c.centerX,c.centerY,c.r),b.circle(c.centerX,c.centerY,c.sr),b.circle(c.centerX,c.centerY,c.fr)),a.glow({width:1,offsety:3,offsetx:-2,opacity:.3}),this.circleSet=a,this},e.prototype.innerLine=function(){var a=this.paper,d=this.conf,e=this.circleSet;return b({centerX:d.centerX,centerY:d.centerY,count:d.count,deg:d.deg,r:d.fr},function(b,f){var g=c({from:[d.centerX,d.centerY],to:[b,f]});e.push(a.path(g))}),this},e.prototype.levelFigure=function(){var a=this.paper,c=this.conf,d=this.circleSet;c.levelArr=[];for(var e=0;e<c.levelTotal;e++){var f=c.levelWidth*(e+1);b({centerX:c.centerX,centerY:c.centerY,count:c.count,deg:c.deg,r:f},function(b,e){c.levelArr.push({x:b,y:e}),d.push(a.circle(b,e,1))})}return this},e.prototype.levelStatus=function(){var a,c,d=this.paper,e=this.conf,f=_.keys(e.data.status),g=_.values(e.data.status);return this.SLSet&&this.SNSet&&(this.SLSet.remove(),this.SNSet.remove()),a=d.set(),c=d.set(),b({centerX:e.centerX,centerY:e.centerY,count:e.count,deg:e.deg,r:e.r-40},function(b,c,f){var h=e.levelCode.charAt(g[f]-1);a.push(d.text(b,c,h))}),this.SLSet=a.attr({"font-size":"18","font-weight":"bold"}),b({centerX:e.centerX,centerY:e.centerY,count:e.count,deg:e.deg,r:e.r-20},function(a,b,g){var h=f[g],i=g*e.deg;i>=90&&270>=i&&(i-=180),c.push(d.text(a,b,h).transform("r"+i))}),this.SNSet=c.attr("font-weight","bold"),this},e.prototype.decoratorFigure=function(){this.dfInnerSet&&this.dfOutterSet&&(this.dfInnerSet.remove(),this.dfOutterSet.remove());var a=this.paper,d=this.conf,e=d.centerX,f=d.centerY,g=(d.count,d.deg,d.r),h=d.sr,i=d.figureCount,j=a.set(),k=a.set(),l=[],m=[],n=[];b({centerX:e,centerY:f,count:i,deg:360/i,r:g},function(a,b){m.push({x:a,y:b})}),b({centerX:e,centerY:f,count:i,deg:360/i,r:h},function(a,b){n.push({x:a,y:b})}),b({centerX:e,centerY:f,count:i,deg:360/i,r:g-5},function(a,b){l.push({x:a,y:b})});for(var o=0;o<d.figureCount;o++){var p,q;p=c({from:[n[o].x,n[o].y],to:[l[o].x,l[o].y]}),q=c({from:[l[o].x,l[o].y],to:[m[o].x,m[o].y]}),j.push(a.path(p)),k.push(a.path(q))}this.dfInnerSet=j.attr("stroke-width",5),this.dfOutterSet=k.attr("stroke-width",5);var r=0,s=function(a){r>10||(setTimeout(function(){s(3*r+100)},a+30),j.forEach(function(b,c){var d=j[c],e=k[c],f=c+1==j.length?j[0]:j[c+1],g=0==c?k[k.length-1]:k[c-1];d.animate({path:f.attr("path")[0].toString().replace(","," ")+f.attr("path")[1].toString().replace(","," ")},a,"easeOut"),e.animate({path:g.attr("path")[0].toString().replace(","," ")+g.attr("path")[1].toString().replace(","," ")},a,"easeOut")}),r++)};return s(80),this},e.prototype.levelArea=function(){this.powerArea&&(this.powerArea.remove(),this.firstLineSet.remove());var a=this.paper,b=this.conf,d=b.centerX,e=b.centerY,f=b.count,g=(b.deg,b.r,b.levelWidth,b.levelTotal,b.levelArr),h=b.data,i=[],j=[],k=a.set(),l=1;for(var m in h.status){var n=h.status[m],o=n*f-(f-l)-1,p=g[o];j.push(g[(l-1)*f]),i.push(p),l++}for(var q=0;q<j.length-1;q++){var r=b.levelCode.charAt(q),s=a.text(j[q].x+8,j[q].y-3,r);k.push(s)}k.attr("font-size",10);var t,u;t=c({from:[d,e]}),u=c({from:[i[0].x,i[0].y]});for(var v=1;v<i.length;v++)u+=c({to:[i[v].x,i[v].y]}),t+=c({to:[d,e]});var w=a.path(t+"Z").animate({path:u+"Z"},1500,"easeOut");return w.attr({fill:h.theme,"fill-opacity":.3}).toBack(),this.powerArea=w,this.firstLineSet=k,this},e});